<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Gestor de Pedidos - Alfajores</title>
<style>
*{margin:0;padding:0;box-sizing:border-box;}
body{font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;background:linear-gradient(135deg,#8B6F47 0%,#D2B48C 100%);min-height:100vh;padding:20px;}
.container{max-width:1200px;margin:0 auto;}
header{background:white;padding:30px;border-radius:15px;box-shadow:0 10px 30px rgba(0,0,0,0.2);margin-bottom:30px;text-align:center;position:relative;}
h1{color:#6F4E37;font-size:2.5em;margin-bottom:10px;}
.settings-icon{position:absolute;top:30px;right:30px;width:40px;height:40px;background:#8B6F47;border-radius:50%;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all 0.3s;font-size:20px;color:white;}
.settings-icon:hover{background:#6F4E37;transform:rotate(90deg);}
.modal{display:none;position:fixed;z-index:1000;left:0;top:0;width:100%;height:100%;background-color:rgba(0,0,0,0.5);}
.modal.show{display:flex;align-items:center;justify-content:center;}
.modal-content{background:white;padding:30px;border-radius:15px;max-width:500px;width:90%;box-shadow:0 10px 30px rgba(0,0,0,0.3);max-height:90vh;overflow-y:auto;}
.modal-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;}
.modal-header h2{color:#6F4E37;}
.close-btn{font-size:28px;font-weight:bold;color:#999;cursor:pointer;background:none;border:none;padding:0;width:30px;height:30px;}
.close-btn:hover{color:#333;}
.tabs{display:flex;gap:10px;margin-bottom:30px;background:white;padding:10px;border-radius:15px;box-shadow:0 5px 15px rgba(0,0,0,0.1);}
.tab-button{flex:1;padding:15px;border:none;background:#f5f5f5;border-radius:10px;cursor:pointer;font-size:16px;font-weight:600;transition:all 0.3s;color:#6F4E37;}
.tab-button.active{background:linear-gradient(135deg,#8B6F47 0%,#6F4E37 100%);color:white;}
.tab-content{display:none;background:white;padding:30px;border-radius:15px;box-shadow:0 10px 30px rgba(0,0,0,0.2);}
.tab-content.active{display:block;}
.form-group{margin-bottom:20px;}
label{display:block;margin-bottom:8px;font-weight:600;color:#6F4E37;}
input,select{width:100%;padding:12px;border:2px solid #D2B48C;border-radius:8px;font-size:16px;transition:border 0.3s;font-family:inherit;}
input:focus,select:focus{outline:none;border-color:#8B6F47;}
button{background:linear-gradient(135deg,#8B6F47 0%,#6F4E37 100%);color:white;padding:12px 30px;border:none;border-radius:8px;cursor:pointer;font-size:16px;font-weight:600;transition:transform 0.2s;}
button:hover{transform:translateY(-2px);}
button:disabled{opacity:0.6;cursor:not-allowed;}
.kiosk-list{display:grid;gap:15px;margin-top:20px;}
.kiosk-item{background:#FFF8DC;padding:20px;border-radius:10px;border-left:5px solid #8B6F47;display:flex;justify-content:space-between;align-items:center;}
.kiosk-info h3{color:#6F4E37;margin-bottom:5px;}
.kiosk-info p{color:#8B6F47;font-size:14px;margin:3px 0;}
.quantity-controls{display:flex;gap:15px;margin-top:15px;}
.quantity-group{flex:1;}
.quantity-group label{font-size:14px;margin-bottom:5px;}
.quantity-input{display:flex;align-items:center;gap:10px;}
.quantity-input button{width:40px;height:40px;padding:0;font-size:20px;}
.quantity-input input{width:80px;text-align:center;}
.delete-btn{background:#A0522D;padding:8px 15px;font-size:14px;}
.delete-btn:hover{background:#8B4513;}
.delete-order-btn{background:#c0392b;padding:6px 12px;font-size:13px;border:none;border-radius:8px;color:white;cursor:pointer;margin-top:8px;}
.empty-state{text-align:center;padding:40px;color:#999;}
.stats{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:15px;margin-bottom:20px;}
.stat-card{background:linear-gradient(135deg,#8B6F47 0%,#6F4E37 100%);color:white;padding:20px;border-radius:10px;text-align:center;}
.stat-card h4{font-size:14px;opacity:0.9;margin-bottom:10px;}
.stat-card p{font-size:32px;font-weight:bold;}
.checkbox-group{display:flex;align-items:center;gap:10px;margin-top:15px;padding:15px;background:#FFF8DC;border-radius:8px;border:2px solid #DEB887;}
.checkbox-group input[type="checkbox"]{width:24px;height:24px;cursor:pointer;}
.checkbox-group label{margin:0;cursor:pointer;color:#8B4513;font-size:16px;}
.price-display{background:#FFF8DC;padding:15px;border-radius:8px;margin-top:15px;border:2px solid #DEB887;}
.price-display h4{color:#6F4E37;margin-bottom:10px;}
.price-display p{color:#8B4513;font-size:18px;font-weight:600;margin:5px 0;}
.currency-input{position:relative;}
.currency-input::before{content:'$';position:absolute;left:12px;top:50%;transform:translateY(-50%);font-weight:600;color:#8B6F47;}
.currency-input input{padding-left:28px;}
.sync-status{position:fixed;bottom:20px;right:20px;background:white;padding:10px 20px;border-radius:25px;box-shadow:0 4px 12px rgba(0,0,0,0.15);font-size:14px;color:#6F4E37;display:none;z-index:9999;}
.sync-status.show{display:block;}
small{display:block;margin-top:5px;color:#8B6F47;font-size:12px;}
.loading{text-align:center;padding:40px;color:#6F4E37;font-size:18px;}
.order-list{margin-top:20px;}
.week-navigation{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;padding:15px;background:#FFF8DC;border-radius:10px;}
.week-navigation button{padding:10px 20px;font-size:14px;}
.week-navigation h3{color:#6F4E37;font-size:18px;}
.kiosk-group{background:#FFF8DC;padding:20px;margin:15px 0;border-radius:10px;border-left:5px solid #8B6F47;}
.kiosk-group-header{color:#6F4E37;font-size:20px;font-weight:bold;margin-bottom:15px;padding-bottom:10px;border-bottom:2px solid #D2B48C;}
.order-item{background:white;padding:15px;margin:10px 0;border-radius:8px;border-left:3px solid #8B6F47;}
.order-item.pending-delivery{border-left-color:#FF6B6B;}
.order-item.pending-payment{border-left-color:#FFA500;}
.status-badges{display:flex;gap:10px;margin:10px 0;flex-wrap:wrap;}
.status-badge{display:inline-block;padding:5px 12px;border-radius:15px;font-size:13px;font-weight:600;}
.status-badge.delivered{background:#d4edda;color:#155724;}
.status-badge.pending-del{background:#fff3cd;color:#856404;}
.status-badge.paid{background:#d4edda;color:#155724;}
.status-badge.pending-pay{background:#f8d7da;color:#721c24;}
.action-buttons{display:flex;gap:8px;margin-top:10px;flex-wrap:wrap;}
.action-buttons button{padding:6px 12px;font-size:13px;}
.btn-delivery{background:#17a2b8;}
.btn-payment{background:#28a745;}
.kiosk-totals{background:#fff;padding:10px;border-radius:8px;margin-top:10px;font-size:14px;color:#6F4E37;}
</style>
</head>
<body>
<div class="container">
<header>
<h1>üç™ Gestor de Pedidos de Alfajores</h1>
<p>Sistema de gesti√≥n para kioscos</p>
<div class="settings-icon" onclick="openSettings()">‚öôÔ∏è</div>
</header>
<div class="tabs">
<button class="tab-button active" onclick="switchTab('kiosks')">Kioscos</button>
<button class="tab-button" onclick="switchTab('orders')">Nuevo Pedido</button>
<button class="tab-button" onclick="switchTab('history')">Historial</button>
</div>
<div id="kiosks" class="tab-content active">
<h2>Gesti√≥n de Kioscos</h2>
<div class="form-group">
<label>Nombre del Kiosco</label>
<input type="text" id="kioskName" placeholder="Ej: Kiosco La Esquina">
</div>
<div class="form-group">
<label>Due√±o</label>
<input type="text" id="kioskOwner" placeholder="Ej: Juan P√©rez">
</div>
<div class="form-group">
<label>Direcci√≥n</label>
<input type="text" id="kioskAddress" placeholder="Ej: Av. Principal 123">
</div>
<div class="form-group">
<label>Tel√©fono</label>
<input type="tel" id="kioskPhone" placeholder="Ej: 11-1234-5678">
</div>
<button onclick="addKiosk()">Agregar Kiosco</button>
<div class="kiosk-list" id="kioskList"></div>
</div>
<div id="orders" class="tab-content">
<h2>Crear Nuevo Pedido</h2>
<div class="form-group">
<label>Seleccionar Kiosco</label>
<select id="orderKiosk">
<option value="">Seleccione un kiosco</option>
</select>
</div>
<div class="quantity-controls">
<div class="quantity-group">
<label>Cajas de 1 Docena (12 unidades)</label>
<div class="quantity-input">
<button onclick="changeQuantity('fullBox',-1)">-</button>
<input type="number" id="fullBox" value="0" min="0" readonly>
<button onclick="changeQuantity('fullBox',1)">+</button>
</div>
</div>
<div class="quantity-group">
<label>Cajas de Media Docena (6 unidades)</label>
<div class="quantity-input">
<button onclick="changeQuantity('halfBox',-1)">-</button>
<input type="number" id="halfBox" value="0" min="0" readonly>
<button onclick="changeQuantity('halfBox',1)">+</button>
</div>
</div>
</div>
<div class="checkbox-group">
<input type="checkbox" id="pendingDelivery">
<label for="pendingDelivery">üì¶ Entrega pendiente</label>
</div>
<div class="checkbox-group">
<input type="checkbox" id="pendingPayment">
<label for="pendingPayment">üí∞ Pago pendiente</label>
</div>
<button onclick="createOrder()" style="margin-top:20px;">Crear Pedido</button>
<div class="price-display" id="orderPrice">
<h4>üí∞ Valor del Pedido</h4>
<p>Total: $0</p>
</div>
</div>
<div id="history" class="tab-content">
<h2>Historial por Semana</h2>
<div class="week-navigation">
<button onclick="changeWeek(-1)">‚¨ÖÔ∏è Anterior</button>
<h3 id="currentWeekDisplay">Cargando...</h3>
<button onclick="changeWeek(1)">Siguiente ‚û°Ô∏è</button>
</div>
<div class="stats" id="stats"></div>
<button onclick="exportData()">üì• Descargar Respaldo</button>
<div class="loading" id="loadingHistory">Cargando...</div>
<div class="order-list" id="orderList"></div>
</div>
</div>
<div id="settingsModal" class="modal">
<div class="modal-content">
<div class="modal-header">
<h2>‚öôÔ∏è Precios</h2>
<button class="close-btn" onclick="closeSettings()">&times;</button>
</div>
<div class="form-group">
<label>Precio Docena (12 unidades)</label>
<div class="currency-input">
<input type="number" id="priceFullBox" min="0" step="0.01">
</div>
</div>
<div class="form-group">
<label>Precio Media Docena (6 unidades)</label>
<div class="currency-input">
<input type="number" id="priceHalfBox" min="0" step="0.01">
</div>
</div>
<div class="form-group">
<label>Precio Mayorista (5+ docenas)</label>
<div class="currency-input">
<input type="number" id="priceBulkBox" min="0" step="0.01">
</div>
<small>Se aplica autom√°ticamente con 5 o m√°s docenas</small>
</div>
<button onclick="savePrices()">üíæ Guardar</button>
<div class="price-display" style="margin-top:20px;">
<h4>üìä Precios Actuales</h4>
<p id="currentPrices">Cargando...</p>
</div>
</div>
</div>
<div class="sync-status" id="syncStatus">‚è≥ Sincronizando...</div>
<script>
const _tk=['Z2hwX1lPQnl', 'qbWtFTUJkRD', 'lhOG5zalJ4V', '2pwWURKejZx', 'ZzE3Q0hxTg=='];
const REPO_OWNER='PuebloMaya';
const REPO_NAME='PuebloMaya';
function _dt(){return _tk.map(p=>atob(p)).join('');}
let appData={kioscos:[],pedidos:[],precios:{fullBox:0,halfBox:0,bulkBox:0}};
let currentSha={kioscos:null,pedidos:null,precios:null};
let currentWeekIndex=0;
let allWeeks=[];
async function leerArchivoGitHub(archivo){
const url='https://api.github.com/repos/'+REPO_OWNER+'/'+REPO_NAME+'/contents/alfajores/'+archivo;
try{
const response=await fetch(url,{headers:{'Authorization':'Bearer '+_dt(),'Accept':'application/vnd.github.v3+json'}});
if(response.status===404)return{datos:null,sha:null};
if(response.ok){
const data=await response.json();
const contenido=atob(data.content);
const datos=JSON.parse(contenido);
return{datos,sha:data.sha};
}
return{datos:null,sha:null};
}catch(error){console.error('Error leyendo',archivo,error);return{datos:null,sha:null};}
}
async function escribirArchivoGitHub(archivo,datos,sha){
const url='https://api.github.com/repos/'+REPO_OWNER+'/'+REPO_NAME+'/contents/alfajores/'+archivo;
const contenidoJSON=JSON.stringify(datos,null,2);
const contenidoBase64=btoa(unescape(encodeURIComponent(contenidoJSON)));
const payload={message:'Actualizaci√≥n de '+archivo,content:contenidoBase64};
if(sha)payload.sha=sha;
try{
const response=await fetch(url,{method:'PUT',headers:{'Authorization':'Bearer '+_dt(),'Accept':'application/vnd.github.v3+json'},body:JSON.stringify(payload)});
if(response.ok){
const result=await response.json();
return result.content.sha;
}
console.error('Error escribiendo',archivo,response.status);
return null;
}catch(error){console.error('Error escribiendo',archivo,error);return null;}
}
async function syncData(silent){
if(!silent)showSyncStatus('‚è≥ Cargando...');
try{
const kioscos=await leerArchivoGitHub('kioscos.json');
if(kioscos.datos){appData.kioscos=kioscos.datos;currentSha.kioscos=kioscos.sha;}else{appData.kioscos=[];}
const pedidos=await leerArchivoGitHub('pedidos.json');
if(pedidos.datos){
appData.pedidos=pedidos.datos.map(p=>(({...p,pendingDelivery:p.pendingDelivery!==undefined?p.pendingDelivery:false})));
currentSha.pedidos=pedidos.sha;
}else{appData.pedidos=[];}
const precios=await leerArchivoGitHub('precios.json');
if(precios.datos){appData.precios=precios.datos;currentSha.precios=precios.sha;}else{appData.precios={fullBox:0,halfBox:0,bulkBox:0};}
displayKiosks();updateKioskSelect();calculateWeeks();displayOrdersByWeek();displayStats();updateCurrentPricesDisplay();updateOrderPrice();
if(!silent){showSyncStatus('‚úÖ Cargado');setTimeout(function(){hideSyncStatus();},2000);}
}catch(error){console.error('Error sync',error);if(!silent){showSyncStatus('‚ùå Error');setTimeout(function(){hideSyncStatus();},3000);}}
}
async function guardarEnGitHub(silent){
if(!silent)showSyncStatus('üíæ Guardando...');
try{
const newKioscosSha=await escribirArchivoGitHub('kioscos.json',appData.kioscos,currentSha.kioscos);
if(newKioscosSha)currentSha.kioscos=newKioscosSha;
const newPedidosSha=await escribirArchivoGitHub('pedidos.json',appData.pedidos,currentSha.pedidos);
if(newPedidosSha)currentSha.pedidos=newPedidosSha;
const newPreciosSha=await escribirArchivoGitHub('precios.json',appData.precios,currentSha.precios);
if(newPreciosSha)currentSha.precios=newPreciosSha;
if(!silent){showSyncStatus('‚úÖ Guardado');setTimeout(function(){hideSyncStatus();},2000);}
return true;
}catch(error){
console.error('Error guardando',error);
if(!silent){showSyncStatus('‚ùå Error');setTimeout(function(){hideSyncStatus();},3000);}
return false;
}
}
function showSyncStatus(message){document.getElementById('syncStatus').textContent=message;document.getElementById('syncStatus').classList.add('show');}
function hideSyncStatus(){document.getElementById('syncStatus').classList.remove('show');}
function calculatePrice(fullBox,halfBox){
let total=0;
if(fullBox>=5&&appData.precios.bulkBox>0){total=fullBox*appData.precios.bulkBox;}else{total=fullBox*appData.precios.fullBox;}
total+=halfBox*appData.precios.halfBox;
return total;
}
function formatPrice(price){return new Intl.NumberFormat('es-AR',{style:'currency',currency:'ARS',minimumFractionDigits:2}).format(price);}
function formatDate(date){const d=new Date(date);return d.toLocaleDateString('es-AR',{day:'2-digit',month:'2-digit',year:'numeric'});}
function getWeekStart(date){
const d=new Date(date);
const day=d.getDay();
const diff=d.getDate()-day+(day===0?-6:1);
const monday=new Date(d.setDate(diff));
monday.setHours(0,0,0,0);
return monday;
}
function getWeekEnd(weekStart){
const end=new Date(weekStart);
end.setDate(end.getDate()+4);
return end;
}
function formatWeekRange(weekStart){
const end=getWeekEnd(weekStart);
const startStr=weekStart.toLocaleDateString('es-AR',{day:'2-digit',month:'2-digit'});
const endStr=end.toLocaleDateString('es-AR',{day:'2-digit',month:'2-digit',year:'numeric'});
return startStr+' al '+endStr;
}
function calculateWeeks(){
if(appData.pedidos.length===0){allWeeks=[];return;}
const weeks=new Set();
appData.pedidos.forEach(p=>{
const weekStart=getWeekStart(new Date(p.createdAt));
weeks.add(weekStart.getTime());
});
allWeeks=Array.from(weeks).sort((a,b)=>b-a).map(t=>new Date(t));
currentWeekIndex=0;
}
function changeWeek(delta){
currentWeekIndex+=delta;
if(currentWeekIndex<0)currentWeekIndex=0;
if(currentWeekIndex>=allWeeks.length)currentWeekIndex=allWeeks.length-1;
displayOrdersByWeek();
displayStats();
}
function displayOrdersByWeek(){
const list=document.getElementById('orderList');
const loading=document.getElementById('loadingHistory');
const weekDisplay=document.getElementById('currentWeekDisplay');
if(appData.pedidos.length===0){
loading.style.display='none';
list.innerHTML='<div class="empty-state">No hay pedidos</div>';
weekDisplay.textContent='Sin pedidos';
return;
}
loading.style.display='none';
if(allWeeks.length===0){
list.innerHTML='<div class="empty-state">No hay pedidos</div>';
weekDisplay.textContent='Sin pedidos';
return;
}
const currentWeek=allWeeks[currentWeekIndex];
const weekEnd=getWeekEnd(currentWeek);
weekDisplay.textContent='Semana del '+formatWeekRange(currentWeek);
const weekOrders=appData.pedidos.filter(p=>{
const orderDate=getWeekStart(new Date(p.createdAt));
return orderDate.getTime()===currentWeek.getTime();
});
if(weekOrders.length===0){
list.innerHTML='<div class="empty-state">No hay pedidos en esta semana</div>';
return;
}
const groupedByKiosk={};
weekOrders.forEach(order=>{
if(!groupedByKiosk[order.kioskId]){
groupedByKiosk[order.kioskId]={
kioskName:order.kioskName,
orders:[]
};
}
groupedByKiosk[order.kioskId].orders.push(order);
});
let html='';
Object.keys(groupedByKiosk).forEach(kioskId=>{
const group=groupedByKiosk[kioskId];
const totalFullBox=group.orders.reduce((sum,o)=>sum+o.fullBox,0);
const totalHalfBox=group.orders.reduce((sum,o)=>sum+o.halfBox,0);
const totalPrice=group.orders.reduce((sum,o)=>sum+(o.price||0),0);
const totalUnits=group.orders.reduce((sum,o)=>sum+o.totalUnits,0);
html+='<div class="kiosk-group">';
html+='<div class="kiosk-group-header">üè™ '+group.kioskName+'</div>';
group.orders.forEach(order=>{
const deliveryClass=order.pendingDelivery?'pending-delivery':'';
const paymentClass=order.pendingPayment?'pending-payment':'';
const deliveryBadge=order.pendingDelivery?'<span class="status-badge pending-del">üì¶ Pendiente entrega</span>':'<span class="status-badge delivered">‚úÖ Entregado</span>';
const paymentBadge=order.pendingPayment?'<span class="status-badge pending-pay">üí∞ Pago pendiente</span>':'<span class="status-badge paid">‚úÖ Pagado</span>';
const bulkText=order.isBulkPrice?'<p style="color:#CD853F;font-size:12px;">‚ú® Precio mayorista</p>':'';
const deliveryBtn=order.pendingDelivery?'<button class="btn-delivery" onclick="toggleDelivery('+order.id+')">‚úÖ Marcar Entregado</button>':'<button class="btn-delivery" onclick="toggleDelivery('+order.id+')">‚Ü©Ô∏è Marcar Pendiente</button>';
const paymentBtn=order.pendingPayment?'<button class="btn-payment" onclick="togglePayment('+order.id+')">‚úÖ Marcar Pagado</button>':'<button class="btn-payment" onclick="togglePayment('+order.id+')">‚Ü©Ô∏è Marcar Pendiente</button>';
html+='<div class="order-item '+deliveryClass+' '+paymentClass+'">';
html+='<p style="margin:5px 0;">üìÖ '+formatDate(order.createdAt)+'</p>';
html+='<p style="margin:5px 0;">üç™ Docenas: '+order.fullBox+' | Medias: '+order.halfBox+'</p>';
html+='<p style="margin:5px 0;">üì¶ Total: '+order.totalUnits+' unidades</p>';
html+='<p style="margin:5px 0;font-weight:600;color:#6F4E37;">üí∞ '+formatPrice(order.price||0)+'</p>';
html+=bulkText;
html+='<div class="status-badges">'+deliveryBadge+paymentBadge+'</div>';
html+='<div class="action-buttons">'+deliveryBtn+paymentBtn+'<button class="delete-order-btn" onclick="deleteOrder('+order.id+')">üóëÔ∏è Eliminar</button></div>';
html+='</div>';
});
html+='<div class="kiosk-totals">';
html+='<strong>Total del kiosco:</strong><br>';
html+='üç™ Docenas: '+totalFullBox+' | Medias: '+totalHalfBox+'<br>';
html+='üì¶ Unidades: '+totalUnits+'<br>';
html+='üí∞ Total: '+formatPrice(totalPrice);
html+='</div>';
html+='</div>';
});
list.innerHTML=html;
}
function displayStats(){
if(allWeeks.length===0||!allWeeks[currentWeekIndex]){
document.getElementById('stats').innerHTML='';
return;
}
const currentWeek=allWeeks[currentWeekIndex];
const weekEnd=getWeekEnd(currentWeek);
const weekOrders=appData.pedidos.filter(p=>{
const orderDate=getWeekStart(new Date(p.createdAt));
return orderDate.getTime()===currentWeek.getTime();
});
const totalOrders=weekOrders.length;
const totalFullBoxes=weekOrders.reduce(function(sum,o){return sum+o.fullBox;},0);
const totalHalfBoxes=weekOrders.reduce(function(sum,o){return sum+o.halfBox;},0);
const totalUnits=weekOrders.reduce(function(sum,o){return sum+o.totalUnits;},0);
const totalMoney=weekOrders.reduce(function(sum,o){return sum+(o.price||0);},0);
const pendingDeliveries=weekOrders.filter(function(o){return o.pendingDelivery;}).length;
const pendingPayments=weekOrders.filter(function(o){return o.pendingPayment;}).length;
document.getElementById('stats').innerHTML='<div class="stat-card"><h4>Total Pedidos</h4><p>'+totalOrders+'</p></div><div class="stat-card"><h4>Docenas</h4><p>'+totalFullBoxes+'</p></div><div class="stat-card"><h4>Medias</h4><p>'+totalHalfBoxes+'</p></div><div class="stat-card"><h4>Unidades</h4><p>'+totalUnits+'</p></div><div class="stat-card"><h4>Total Dinero</h4><p>'+formatPrice(totalMoney)+'</p></div><div class="stat-card" style="background:linear-gradient(135deg,#FF6B6B 0%,#C92A2A 100%)"><h4>Entregas Pendientes</h4><p>'+pendingDeliveries+'</p></div><div class="stat-card" style="background:linear-gradient(135deg,#FFA500 0%,#FF6B00 100%)"><h4>Pagos Pendientes</h4><p>'+pendingPayments+'</p></div>';
}
function openSettings(){document.getElementById('settingsModal').classList.add('show');loadPrices();}
function closeSettings(){document.getElementById('settingsModal').classList.remove('show');}
window.onclick=function(event){
const modal=document.getElementById('settingsModal');
if(event.target===modal){closeSettings();}
}
function switchTab(tabName){
document.querySelectorAll('.tab-content').forEach(function(tab){tab.classList.remove('active');});
document.querySelectorAll('.tab-button').forEach(function(btn){btn.classList.remove('active');});
document.getElementById(tabName).classList.add('active');
event.target.classList.add('active');
if(tabName==='orders')updateKioskSelect();
if(tabName==='history'){calculateWeeks();displayOrdersByWeek();displayStats();}
}
async function addKiosk(){
const name=document.getElementById('kioskName').value.trim();
const owner=document.getElementById('kioskOwner').value.trim();
const address=document.getElementById('kioskAddress').value.trim();
const phone=document.getElementById('kioskPhone').value.trim();
if(!name){alert('Ingrese el nombre del kiosco');return;}
const kiosk={id:Date.now(),name:name,owner:owner,address:address,phone:phone,createdAt:new Date().toISOString()};
appData.kioscos.push(kiosk);
const exito=await guardarEnGitHub();
if(exito){
document.getElementById('kioskName').value='';
document.getElementById('kioskOwner').value='';
document.getElementById('kioskAddress').value='';
document.getElementById('kioskPhone').value='';
displayKiosks();
alert('Kiosco agregado');
}
}
function displayKiosks(){
const list=document.getElementById('kioskList');
if(appData.kioscos.length===0){list.innerHTML='<div class="empty-state">No hay kioscos</div>';return;}
list.innerHTML=appData.kioscos.map(function(k){
return '<div class="kiosk-item"><div class="kiosk-info"><h3>'+k.name+'</h3><p>üë§ '+(k.owner||'No especificado')+'</p><p>üìç '+(k.address||'Sin direcci√≥n')+'</p><p>üìû '+(k.phone||'Sin tel√©fono')+'</p></div><button class="delete-btn" onclick="deleteKiosk('+k.id+')">Eliminar</button></div>';
}).join('');
}
async function deleteKiosk(id){
if(confirm('¬øEliminar kiosco?')){
appData.kioscos=appData.kioscos.filter(function(k){return k.id!==id;});
await guardarEnGitHub();
displayKiosks();
updateKioskSelect();
}
}
function updateKioskSelect(){
const select=document.getElementById('orderKiosk');
select.innerHTML='<option value="">Seleccione un kiosco</option>'+appData.kioscos.map(function(k){return '<option value="'+k.id+'">'+k.name+'</option>';}).join('');
}
function changeQuantity(type,delta){
const input=document.getElementById(type);
let value=parseInt(input.value)||0;
value=Math.max(0,value+delta);
input.value=value;
updateOrderPrice();
}
function updateOrderPrice(){
const fullBox=parseInt(document.getElementById('fullBox').value)||0;
const halfBox=parseInt(document.getElementById('halfBox').value)||0;
const total=calculatePrice(fullBox,halfBox);
let priceInfo='';
if(fullBox>=5&&appData.precios.bulkBox>0){
priceInfo='<p style="color:#CD853F;font-size:12px;margin-top:5px;">‚ú® Precio mayorista: '+formatPrice(appData.precios.bulkBox)+'/docena</p>';
}
document.getElementById('orderPrice').innerHTML='<h4>üí∞ Valor del Pedido</h4><p>Total: '+formatPrice(total)+'</p>'+priceInfo;
}
async function createOrder(){
const kioskId=parseInt(document.getElementById('orderKiosk').value);
const fullBox=parseInt(document.getElementById('fullBox').value)||0;
const halfBox=parseInt(document.getElementById('halfBox').value)||0;
const pendingDelivery=document.getElementById('pendingDelivery').checked;
const pendingPayment=document.getElementById('pendingPayment').checked;
if(!kioskId){alert('Seleccione un kiosco');return;}
if(fullBox===0&&halfBox===0){alert('Agregue al menos una caja');return;}
const kiosk=appData.kioscos.find(function(k){return k.id===kioskId;});
const now=new Date();
const orderPrice=calculatePrice(fullBox,halfBox);
const isBulkPrice=fullBox>=5&&appData.precios.bulkBox>0;
const order={id:Date.now(),kioskId:kioskId,kioskName:kiosk.name,fullBox:fullBox,halfBox:halfBox,totalUnits:(fullBox*12)+(halfBox*6),price:orderPrice,isBulkPrice:isBulkPrice,pendingDelivery:pendingDelivery,pendingPayment:pendingPayment,createdAt:now.toISOString(),date:formatDate(now)};
appData.pedidos.push(order);
const exito=await guardarEnGitHub();
if(exito){
document.getElementById('orderKiosk').value='';
document.getElementById('fullBox').value='0';
document.getElementById('halfBox').value='0';
document.getElementById('pendingDelivery').checked=false;
document.getElementById('pendingPayment').checked=false;
updateOrderPrice();
alert('Pedido creado');
}
}
async function deleteOrder(orderId){
if(confirm('¬øEliminar pedido?')){
appData.pedidos=appData.pedidos.filter(function(o){return o.id!==orderId;});
const exito=await guardarEnGitHub();
if(exito){calculateWeeks();displayOrdersByWeek();displayStats();alert('Pedido eliminado');}
}
}
async function toggleDelivery(orderId){
const order=appData.pedidos.find(function(o){return o.id===orderId;});
if(order){
order.pendingDelivery=!order.pendingDelivery;
const exito=await guardarEnGitHub();
if(exito){displayOrdersByWeek();displayStats();}
}
}
async function togglePayment(orderId){
const order=appData.pedidos.find(function(o){return o.id===orderId;});
if(order){
order.pendingPayment=!order.pendingPayment;
const exito=await guardarEnGitHub();
if(exito){displayOrdersByWeek();displayStats();}
}
}
function exportData(){
const data={kioscos:appData.kioscos,pedidos:appData.pedidos,precios:appData.precios,exportDate:new Date().toISOString()};
const blob=new Blob([JSON.stringify(data,null,2)],{type:'application/json'});
const url=URL.createObjectURL(blob);
const a=document.createElement('a');
a.href=url;
a.download='pedidos-alfajores-'+new Date().toISOString().split('T')[0]+'.json';
a.click();
}
async function savePrices(){
const fullBox=parseFloat(document.getElementById('priceFullBox').value)||0;
const halfBox=parseFloat(document.getElementById('priceHalfBox').value)||0;
const bulkBox=parseFloat(document.getElementById('priceBulkBox').value)||0;
if(fullBox<0||halfBox<0||bulkBox<0){alert('Los precios no pueden ser negativos');return;}
appData.precios={fullBox:fullBox,halfBox:halfBox,bulkBox:bulkBox};
const exito=await guardarEnGitHub();
if(exito){updateCurrentPricesDisplay();alert('Precios guardados');}
}
function loadPrices(){
document.getElementById('priceFullBox').value=appData.precios.fullBox;
document.getElementById('priceHalfBox').value=appData.precios.halfBox;
document.getElementById('priceBulkBox').value=appData.precios.bulkBox;
updateCurrentPricesDisplay();
}
function updateCurrentPricesDisplay(){
document.getElementById('currentPrices').innerHTML='Docena: '+formatPrice(appData.precios.fullBox)+'<br>Media: '+formatPrice(appData.precios.halfBox)+'<br>Mayorista: '+formatPrice(appData.precios.bulkBox);
}
window.addEventListener('load',function(){syncData(false);setInterval(function(){syncData(true);},60000);}); </script>
</body>
</html>